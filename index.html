<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verificação de CPF · IAPol®</title>
  <link rel="icon" type="image/png" href="./favicon.png">
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{
      --bg:#0a0f1a; --card:#0f1422; --line:#1e4d92;
      --brand:#1677ff; --brand-2:#0b5ed7;
      --text:#eaf2ff; --muted:#a9c0e6; --soft:#0f203f;
      --danger:#e5534b;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0}
    .wrap{max-width:1180px;margin:0 auto;padding:24px}

    header{display:flex;align-items:center;gap:14px;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:54px;height:54px;object-fit:contain;border-radius:50%}
    .brand h1{font-size:28px;margin:0;color:#d8e8ff;line-height:1.1}
    .brand .badge{margin-top:6px;display:inline-block;padding:4px 12px;border-radius:999px;background:#0f203f;border:1px solid var(--line);color:#dbeaff;font-weight:600;font-size:12px;letter-spacing:.3px}

    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.28);padding:20px}
    .sub{color:var(--muted);margin:8px 0 12px}
    .lgpd{color:#9bb3d8;font-size:12px;margin:0 0 14px}
    form{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    input[type=text]{flex:1;min-width:260px;padding:12px 14px;border-radius:12px;border:1px solid #1b3b6f;background:#0f1422;color:#f0f6ff}
    input.invalid{border-color:var(--danger);outline-color:var(--danger)}
    button{padding:12px 16px;border-radius:12px;border:0;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
    button:hover{background:var(--brand-2)}
    .actions{display:flex;gap:8px;margin:8px 0 4px;flex-wrap:wrap}

    .layout{display:grid;grid-template-columns:420px 1fr;gap:14px;margin-top:12px}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} }

    .groups{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}
    .group{border:1px solid var(--line);border-radius:12px;padding:12px;background:#0f1422}
    .group h2{font-size:15px;margin:0 0 8px;color:#a9d1ff}
    .group ul{list-style:none;margin:0;padding:0}
    .group li{padding:8px 0;border-bottom:1px solid rgba(255,255,255,.06)}
    .group li:last-child{border-bottom:0}
    .group a{color:#9dc9ff;text-decoration:none}
    .group a:hover{text-decoration:underline}

    .preview{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#0f1422;max-height:320px;overflow:auto;margin-top:10px}
    .pv-item{padding:8px;border-bottom:1px solid rgba(255,255,255,.06)}
    .pv-item:last-child{border-bottom:0}
    .pv-title{color:#cfe3ff;font-weight:700;margin-bottom:4px}
    .pv-url{color:#9db9e2;font-size:12px;margin-bottom:4px;word-break:break-all}
    .pv-snippet{color:#c7d6ef;font-size:13px}

    .viewer{border:1px solid var(--line);border-radius:12px;background:#0f1422}
    .viewer-head{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-bottom:1px solid var(--line);background:var(--soft)}
    .viewer-url{color:#9db9e2;font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:80%}
    .viewer-ctrls{display:flex;gap:8px}
    .viewer-ctrls button{padding:8px 10px;font-size:12px}
    iframe#visor{width:100%;height:72vh;border:0;border-bottom-left-radius:12px;border-bottom-right-radius:12px;background:#0b0f1a}

    .footer{margin-top:12px;text-align:center;color:var(--muted);font-size:12px}
  </style>

  <!-- jsPDF (PDF) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img src="./iapol-logo.png" alt="IAPol®" onerror="this.style.display='none'">
        <div>
          <h1>Verificação de CPF</h1>
          <div class="badge">IAPol® | Inteligência Artificial Policial</div>
        </div>
      </div>
    </header>

    <div class="card">
      <p class="sub">Consulta OSINT de **CPF** (público/aberto) com montagem de dorks e acesso a portais oficiais. Não contorna CAPTCHAs nem restrições de autenticação.</p>
      <p class="lgpd"><strong>LGPD/Legal:</strong> use somente para fins legítimos, com base legal e autorização. Não armazene CPFs sem necessidade. Resultados dependem de cada portal (alguns exigem login/captcha).</p>

      <form onsubmit="return gerar()">
        <input type="text" id="cpf" inputmode="numeric" autocomplete="off"
          placeholder="Digite o CPF (ex.: 123.456.789-09)"
          oninput="maskCPF(this)" />
        <button type="submit">Analisar</button>
      </form>

      <div class="actions" id="exportBar" style="display:none">
        <button type="button" onclick="exportCSV()">Exportar CSV</button>
        <button type="button" onclick="exportPDF()">Exportar PDF</button>
      </div>

      <div class="layout">
        <div>
          <div class="groups" id="groups"></div>
          <div class="preview" id="preview" style="display:none"></div>
        </div>

        <div class="viewer">
          <div class="viewer-head">
            <div class="viewer-url" id="viewerUrl">Nenhum conteúdo carregado</div>
            <div class="viewer-ctrls">
              <button type="button" onclick="openInNewTab()">Abrir em nova aba</button>
              <button type="button" onclick="toggleReader()">Alternar leitura</button>
            </div>
          </div>
          <iframe id="visor" sandbox="allow-scripts allow-forms allow-same-origin allow-popups" referrerpolicy="no-referrer"></iframe>
        </div>
      </div>
    </div>

    <div class="footer">IAPol® · uso responsável (LGPD/leis vigentes)</div>
  </div>

<script>
/* ===================== CPF: máscara e validação ===================== */
function onlyDigits(s){ return (s||"").replace(/\D+/g,""); }
function maskCPF(inp){
  const d = onlyDigits(inp.value).slice(0,11);
  let f = d;
  if(d.length>3 && d.length<=6) f = d.slice(0,3)+"."+d.slice(3);
  else if(d.length>6 && d.length<=9) f = d.slice(0,3)+"."+d.slice(3,6)+"."+d.slice(6);
  else if(d.length>9) f = d.slice(0,3)+"."+d.slice(3,6)+"."+d.slice(6,9)+"-"+d.slice(9,11);
  inp.value = f;
}
function validaCPF(cpf){
  const s = onlyDigits(cpf);
  if(s.length!==11 || /^(\d)\1{10}$/.test(s)) return false;
  const calc = (base) => {
    let sum=0, fac = base+1;
    for(let i=0;i<base;i++) sum += parseInt(s[i],10)*(fac-i);
    const r = (sum*10)%11;
    return (r===10?0:r);
  };
  if(calc(9)!==parseInt(s[9],10)) return false;
  if(calc(10)!==parseInt(s[10],10)) return false;
  return true;
}
function ensureCPF(){
  const input = document.getElementById("cpf");
  const ok = validaCPF(input.value);
  input.classList.toggle("invalid", !ok);
  return ok ? { raw: onlyDigits(input.value), fmt: input.value } : null;
}

/* ===================== Diretórios/Dorks ===================== */
/* O modo leitura usa proxy seguro para contornar bloqueios de iframe/cors */
const reader = url => `https://r.jina.ai/http/${url.replace(/^https?:\/\//,'')}`;

const GRUPOS = [
  ["Oficiais (Gov.br/Receita)*", [
    // Portais oficiais: exigem CAPTCHA/autenticação — abrimos a página
    ["Receita Federal — Comprovante de Situação do CPF (CAPTCHA)",
      "https://servicos.receita.fazenda.gov.br/servicos/cpf/consultasituacao/consultaonline.aspx"],
    ["Gov.br — Serviços CPF (login)",
      "https://www.gov.br/pt-br/servicos?termo=cpf"]
  ]],
  ["Motores (dorks)", [
    // Busca pelo número formatado OU sem formatação
    ["Google","https://www.google.com/search?q=%22%CPF_FMT%%22+OR+%CPF_RAW%"],
    ["Bing","https://www.bing.com/search?q=%22%CPF_FMT%%22+OR+%CPF_RAW%"],
    ["DuckDuckGo","https://duckduckgo.com/?q=%22%CPF_FMT%%22+OR+%CPF_RAW%"]
  ]],
  ["Transparência/Diários", [
    ["Diário Oficial (IN) — Google","https://www.google.com/search?q=site:in.gov.br+%22%CPF_FMT%%22+OR+%CPF_RAW%"],
    ["Transparência (genérica) — Google","https://www.google.com/search?q=site:transparencia.*+%22%CPF_FMT%%22+OR+%CPF_RAW%"],
    ["Portais *.jus.br — Google","https://www.google.com/search?q=site:*.jus.br+%22%CPF_FMT%%22+OR+%CPF_RAW%"]
  ]],
  ["Documentos", [
    ["PDF (Google)","https://www.google.com/search?q=filetype:pdf+%22%CPF_FMT%%22+OR+%CPF_RAW%"],
    ["DOCX (Google)","https://www.google.com/search?q=filetype:docx+%22%CPF_FMT%%22+OR+%CPF_RAW%"],
    ["XLSX (Google)","https://www.google.com/search?q=filetype:xlsx+%22%CPF_FMT%%22+OR+%CPF_RAW%"]
  ]]
];

function buildUrl(tpl, cpfFmt, cpfRaw){
  return tpl.replaceAll("%CPF_FMT%", encodeURIComponent(cpfFmt))
            .replaceAll("%CPF_RAW%", encodeURIComponent(cpfRaw));
}

/* ===================== Viewer / Preview ===================== */
function setViewer(url,{forceReader=false}={}){
  const frame = document.getElementById("visor");
  const vurl  = document.getElementById("viewerUrl");
  const u = forceReader ? reader(url) : url;
  frame.src = u;
  vurl.textContent = u;
  window.__viewer_current = url;
  window.__viewer_reader  = forceReader;
}
function toggleReader(){
  if(!window.__viewer_current) return;
  setViewer(window.__viewer_current,{forceReader:!window.__viewer_reader});
}
function openInNewTab(){
  if(!window.__viewer_current) return;
  const url = window.__viewer_reader ? reader(window.__viewer_current) : window.__viewer_current;
  window.open(url, "_blank");
}

async function openDirectory(title, url){
  // Carrega em leitura por padrão (evita bloqueios)
  setViewer(url,{forceReader:true});

  // Prévia textual (melhor esforço)
  const pv = document.getElementById("preview");
  pv.style.display = "block";
  pv.innerHTML = `<div class="pv-item"><div class="pv-title">Carregando prévia de ${title}…</div></div>`;
  try{
    const resp = await fetch(reader(url), {mode:"cors"});
    if(!resp.ok) throw new Error(resp.statusText);
    const txt = await resp.text();
    const lines = txt.split("\n").filter(Boolean);
    const blocks = [];
    let acc=[];
    for(const l of lines){
      if((/^#|^##|\d+\.\s|•\s/).test(l) && acc.length){ blocks.push(acc.join(" ")); acc=[l]; }
      else acc.push(l);
      if(blocks.length>=10) break;
    }
    if(acc.length && blocks.length<10) blocks.push(acc.join(" "));
    pv.innerHTML = blocks.slice(0,8).map((b,i)=>`
      <div class="pv-item">
        <div class="pv-title">${title} — item ${i+1}</div>
        <div class="pv-url">${url}</div>
        <div class="pv-snippet">${b.replace(/\s+/g," ").slice(0,320)}…</div>
        <div style="margin-top:6px">
          <button type="button" onclick="setViewer('${url.replace(/'/g,"\\'")}',{forceReader:false})">Abrir página original</button>
          <button type="button" onclick="setViewer('${url.replace(/'/g,"\\'")}',{forceReader:true})">Abrir em leitura</button>
        </div>
      </div>
    `).join("") || `
      <div class="pv-item">
        <div class="pv-title">${title}</div>
        <div class="pv-url">${url}</div>
        <div class="pv-snippet">Prévia indisponível. Use os botões acima.</div>
      </div>`;
  }catch(e){
    pv.innerHTML = `
      <div class="pv-item">
        <div class="pv-title">${title}</div>
        <div class="pv-url">${url}</div>
        <div class="pv-snippet">Não foi possível obter a prévia agora. O visor já está em modo leitura.</div>
      </div>`;
  }
}

/* ===================== Montagem dos grupos ===================== */
function montarGrupos(cpfFmt, cpfRaw){
  const box = document.getElementById("groups");
  box.innerHTML = "";
  GRUPOS.forEach(([titulo,itens])=>{
    const div = document.createElement("div");
    div.className = "group";
    const h2 = document.createElement("h2"); h2.textContent = titulo;
    const ul = document.createElement("ul");

    itens.forEach(([label,tpl])=>{
      const li = document.createElement("li");
      const a  = document.createElement("a");
      const finalUrl = buildUrl(tpl, cpfFmt, cpfRaw);
      a.textContent = label;
      a.href = "#";
      a.onclick = (ev)=>{ ev.preventDefault(); openDirectory(label, finalUrl); };
      li.appendChild(a); ul.appendChild(li);
    });

    div.appendChild(h2); div.appendChild(ul); box.appendChild(div);
  });
}

/* ===================== Exportações ===================== */
function buildData(cpfFmt, cpfRaw){
  const data = [];
  GRUPOS.forEach(([grupo, itens])=>{
    itens.forEach(([fonte, tpl])=>{
      data.push({grupo, fonte, url: buildUrl(tpl,cpfFmt,cpfRaw)});
    });
  });
  return data;
}
function exportCSV(){
  const state = window.__cpf_state;
  if(!state){ alert("Gere os resultados antes de exportar."); return; }
  const { cpfFmt, cpfRaw } = state;
  const rows = buildData(cpfFmt, cpfRaw);
  let csv = "CPF;GRUPO;FONTE;URL\n";
  rows.forEach(r=>{
    const line = [`"${cpfFmt}"`,`"${r.grupo.replace(/"/g,'""')}"`,`"${r.fonte.replace(/"/g,'""')}"`,`"${r.url.replace(/"/g,'""')}"`].join(";");
    csv += line + "\n";
  });
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob);
  a.download = `IAPol_Verificacao_CPF_${cpfRaw}.csv`; a.click();
}
function exportPDF(){
  const state = window.__cpf_state;
  if(!state){ alert("Gere os resultados antes de exportar."); return; }
  const { cpfFmt, cpfRaw } = state;
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:"pt", format:"a4" });
  const m=48; let y=m;
  doc.setFont("helvetica","bold"); doc.setFontSize(16);
  doc.text("IAPol® — Verificação de CPF", m, y); y+=18;
  doc.setFont("helvetica","normal"); doc.setFontSize(12);
  doc.text(`CPF analisado: ${cpfFmt} (raw: ${cpfRaw})`, m, y); y+=8;
  doc.text(`Data: ${new Date().toLocaleString("pt-BR")}`, m, y); y+=18;
  const rows = buildData(cpfFmt, cpfRaw);
  doc.setFontSize(11);
  let gAtual = "";
  rows.forEach(r=>{
    if(r.grupo!==gAtual){
      if(y>780){ doc.addPage(); y=m; }
      gAtual = r.grupo;
      doc.setFont("helvetica","bold"); doc.text(gAtual, m, y); y+=12;
      doc.setFont("helvetica","normal");
    }
    const ln = `• ${r.fonte}: ${r.url}`;
    const parts = doc.splitTextToSize(ln, 515);
    parts.forEach(L=>{ if(y>800){ doc.addPage(); y=m; } doc.text(L, m, y); y+=14; });
  });
  if(y>800){ doc.addPage(); y=m; }
  doc.setDrawColor(160); doc.line(m,820,595-m,820);
  doc.setFontSize(9); doc.setTextColor(120);
  doc.text("IAPol® · uso responsável (LGPD/leis vigentes) · Portais oficiais podem exigir CAPTCHA/login", m, 838);
  doc.save(`IAPol_Verificacao_CPF_${cpfRaw}.pdf`);
}

/* ===================== Fluxo ===================== */
function gerar(){
  const state = ensureCPF();
  if(!state){
    alert("CPF inválido. Verifique o número e tente novamente.");
    return false;
  }
  const { raw: cpfRaw, fmt: cpfFmt } = state;
  window.__cpf_state = { cpfRaw, cpfFmt };
  history.replaceState({}, "", location.pathname + "?cpf=" + encodeURIComponent(cpfFmt));
  document.getElementById("exportBar").style.display = "flex";
  montarGrupos(cpfFmt, cpfRaw);
  document.getElementById("preview").style.display="none";
  setViewer("about:blank");
  return false;
}

/* Suporte a URL ?cpf= */
(function init(){
  const p = new URLSearchParams(location.search);
  const q = p.get("cpf");
  if(q){
    document.getElementById("cpf").value = q;
    const st = ensureCPF();
    if(st){
      window.__cpf_state = { cpfRaw: st.raw, cpfFmt: st.fmt };
      document.getElementById("exportBar").style.display = "flex";
      montarGrupos(st.fmt, st.raw);
    }
  }
})();
</script>
</body>
</html>
